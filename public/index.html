<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plans Hebdomadaires</title>
    <!-- Dépendances CSS et JS (identiques à l'original) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body dir="ltr">

    <!-- ======================== -->
    <!-- FORMULAIRE DE CONNEXION  -->
    <!-- ======================== -->
    <div id="login-form">
        <img id="logo" src="https://cdn.glitch.global/1c613b14-019c-488a-a856-d55d64d174d0/al-kawthar-international-schools-jeddah-saudi-arabia-modified.png?v=1739565146299" alt="Logo Al-Kawthar">
        <h1>Connexion</h1>
        
        <!-- SÉLECTEUR DE SECTION -->
        <div class="section-selector-container" style="width:100%; margin-bottom:15px;">
            <label for="sectionSelectorLogin"><i class="fas fa-school"></i> Section :</label>
            <select id="sectionSelectorLogin" style="width:100%; padding:10px; border:1px solid #dee2e6; border-radius:5px;">
                <option value="garcons">Garçons</option>
                <option value="filles">Filles</option>
            </select>
        </div>

        <div>
            <label for="username">Nom d'utilisateur (Enseignant) :</label>
            <input type="text" id="username" required>
        </div>
        <div class="password-container">
            <label for="password">Mot de passe (idem Nom) :</label>
            <input type="password" id="password" required>
            <i class="fas fa-eye password-toggle-icon" id="togglePassword"></i>
        </div>
        <div class="remember-me-container">
            <input type="checkbox" id="rememberMe">
            <label for="rememberMe" id="remember-me-label">Rester connecté</label>
        </div>
        <button id="login-button" class="pro-button"><i class="fas fa-sign-in-alt"></i> <span class="btn-text">Se connecter</span></button>
        <p id="login-error"></p>
    </div>

    <!-- ======================== -->
    <!-- CONTENU PRINCIPAL        -->
    <!-- ======================== -->
    <div id="main-content" style="display: none;">

        <!-- En-tête principal (partagé) -->
        <div class="main-header-container">
            <img id="logo-main" src="https://cdn.glitch.global/1c613b14-019c-488a-a856-d55d64d174d0/al-kawthar-international-schools-jeddah-saudi-arabia-modified.png?v=1739565146299" alt="Logo">
            <div class="title-user-info">
                <h1 id="main-title">Plans Hebdomadaires</h1>
                <h2 id="weekDateRange"></h2>
                <div class="user-actions-container">
                    <span id="loggedInUserInfo" style="font-style:italic;"></span>
                    <button id="logout-button" class="pro-button danger-button">
                        <i class="fas fa-sign-out-alt"></i> <span class="btn-text">Déconnecter</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Sélecteur de semaine (partagé) -->
        <div class="filter-container week-selector-container">
            <label for="weekSelector"><i class="fas fa-calendar-week"></i> Semaine:</label>
            <select id="weekSelector" onchange="loadPlanForWeek()"></select>
        </div>

        <!-- Zone pour les messages d'alerte et barre de progression (partagés) -->
        <div id="message-alerte" style="display: none;"></div>
        <div id="progress-bar-container" style="display: none;"><div id="progress-bar">0%</div></div>

        <!-- ================================== -->
        <!-- CONTENEUR POUR LA SECTION GARÇONS  -->
        <!-- ================================== -->
        <div id="section-content-garcons" class="section-container" style="display: none;">
            <h2>Section Garçons</h2>
            <!-- Intégration de l'UI du code original pour cette section -->
            <div id="admin-actions_garcons" class="filter-container admin-section" style="display: none;">
                <!-- Contenu Admin... -->
            </div>
            <div class="filter-container main-actions-container">
                <button id="generateWordBtn_garcons" class="action-button pro-button" disabled><i class="fas fa-file-word"></i> <span class="btn-text">Générer Word par Classe</span></button>
                <button id="generateExcelBtn_garcons" class="action-button pro-button" disabled><i class="fas fa-file-excel"></i> <span class="btn-text">Générer Excel (1 Fichier)</span></button>
                <button id="saveAllDisplayedBtn_garcons" class="action-button pro-button" disabled><i class="fas fa-save"></i> <span class="btn-text">Enregistrer Lignes Affichées</span></button>
            </div>
            <div class="filter-container data-filters-container">
                <label><i class="fas fa-user-tie"></i> Enseignant:</label> <select id="filterEnseignant_garcons"> <option value="">Tous</option> </select>
                <label><i class="fas fa-chalkboard-user"></i> Classe:</label> <select id="filterClasse_garcons"> <option value="">Toutes</option> </select>
                <label><i class="fas fa-book"></i> Matière:</label> <select id="filterMatiere_garcons"> <option value="">Toutes</option> </select>
                <label><i class="fas fa-clock"></i> Période:</label> <select id="filterPeriode_garcons"> <option value="">Toutes</option> </select>
                <label><i class="fas fa-calendar-day"></i> Jour:</label> <select id="filterJour_garcons"><option value="">Tous</option><option value="Dimanche">Dimanche</option><option value="Lundi">Lundi</option><option value="Mardi">Mardi</option><option value="Mercredi">Mercredi</option><option value="Jeudi">Jeudi</option></select>
            </div>
             <div class="notes-container">
                <label><i class="fas fa-sticky-note"></i> Notes pour la classe :</label> <select id="notesClassSelector_garcons"><option value="">-- Sélectionnez une classe --</option></select>
                <textarea id="notesInput_garcons" rows="4" placeholder="Sélectionnez une classe..." spellcheck="true" disabled></textarea>
                <button id="saveNotesBtn_garcons" class="action-button pro-button success-button" disabled><i class="fas fa-save"></i> <span class="btn-text">Enregistrer Notes</span></button>
            </div>
            <div class="table-responsive-wrapper">
                <table id="planTable_garcons"><thead><tr></tr></thead><tbody></tbody></table>
            </div>
        </div>

        <!-- ================================= -->
        <!-- CONTENEUR POUR LA SECTION FILLES  -->
        <!-- ================================= -->
        <div id="section-content-filles" class="section-container" style="display: none;">
            <h2>Section Filles</h2>
            <!-- Intégration de l'UI du code original pour cette section -->
             <div id="admin-actions_filles" class="filter-container admin-section" style="display: none;">
                <!-- Contenu Admin... -->
            </div>
            <div class="filter-container main-actions-container">
                <button id="generateWordBtn_filles" class="action-button pro-button" disabled><i class="fas fa-file-word"></i> <span class="btn-text">Générer Word par Classe</span></button>
                <button id="generateExcelBtn_filles" class="action-button pro-button" disabled><i class="fas fa-file-excel"></i> <span class="btn-text">Générer Excel (1 Fichier)</span></button>
                <button id="saveAllDisplayedBtn_filles" class="action-button pro-button" disabled><i class="fas fa-save"></i> <span class="btn-text">Enregistrer Lignes Affichées</span></button>
            </div>
            <div class="filter-container data-filters-container">
                <label><i class="fas fa-user-tie"></i> Enseignant:</label> <select id="filterEnseignant_filles"> <option value="">Tous</option> </select>
                <label><i class="fas fa-chalkboard-user"></i> Classe:</label> <select id="filterClasse_filles"> <option value="">Toutes</option> </select>
                <label><i class="fas fa-book"></i> Matière:</label> <select id="filterMatiere_filles"> <option value="">Toutes</option> </select>
                <label><i class="fas fa-clock"></i> Période:</label> <select id="filterPeriode_filles"> <option value="">Toutes</option> </select>
                <label><i class="fas fa-calendar-day"></i> Jour:</label> <select id="filterJour_filles"><option value="">Tous</option><option value="Dimanche">Dimanche</option><option value="Lundi">Lundi</option><option value="Mardi">Mardi</option><option value="Mercredi">Mercredi</option><option value="Jeudi">Jeudi</option></select>
            </div>
             <div class="notes-container">
                <label><i class="fas fa-sticky-note"></i> Notes pour la classe :</label> <select id="notesClassSelector_filles"><option value="">-- Sélectionnez une classe --</option></select>
                <textarea id="notesInput_filles" rows="4" placeholder="Sélectionnez une classe..." spellcheck="true" disabled></textarea>
                <button id="saveNotesBtn_filles" class="action-button pro-button success-button" disabled><i class="fas fa-save"></i> <span class="btn-text">Enregistrer Notes</span></button>
            </div>
            <div class="table-responsive-wrapper">
                <table id="planTable_filles"><thead><tr></tr></thead><tbody></tbody></table>
            </div>
        </div>

    </div>

    <script>
    // ====== GLOBALS ======
    let loggedInUser = null;
    let selectedSection = null; // 'garcons' ou 'filles'
    let isAdmin = false;
    let currentWeek = null;

    // Données séparées par section
    const sectionData = {
        garcons: { planData: [], filteredData: [], headers: [], weeklyClassNotes: {} },
        filles:  { planData: [], filteredData: [], headers: [], weeklyClassNotes: {} }
    };
    
    // Admins et listes d'enseignants par section
    const admins = new Set(['Mohamed', 'Zohra']);
    const teachers_garcons = new Set(['Abas','Jaber','Kamel','Majed','Mohamed Ali','Morched','Saeed','Sami','Sylvano','Tonga','Youssef','Zine']);
    const teachers_filles = new Set(['Abeer','Aichetou','Amal','Amal Arabic','Ange','Anouar','Emen','Farah','Fatima Islamic','Ghadah','Hana - Ameni - PE','Nada','Raghd ART','Salma','Sara','Souha','Takwa','Zohra Zidane']);

    const weekDates = { /* ... collez ici l'objet weekDates de votre code actuel ... */ };
    const classOrder = ['PEI1','PEI2','PEI3','PEI4','PEI5','DP1','DP2'];
    function compareClasses(a, b) { const ia=classOrder.indexOf(a), ib=classOrder.indexOf(b); if(ia!==-1&&ib!==-1) return ia-ib; return String(a||'').localeCompare(String(b||'')); }

    // ====== UTILS (Fonctions utilitaires génériques) ======
    function setBtnLoading(btn, loading, iconClass) { if(!btn) return; btn.disabled = loading; const i = btn.querySelector('i'); if(i) i.className = loading ? 'fas fa-spinner fa-spin' : iconClass; }
    function alertMsg(msg, type='success') { const div=document.getElementById('message-alerte'); div.className=`message-alert-base alert-${type}`; div.textContent=msg; div.style.display='block'; setTimeout(() => { div.style.display='none'; }, type==='error' ? 8000 : 5000); }
    function formatUpdatedAt(s) { if(!s) return ''; const d=new Date(s); if(isNaN(d.getTime())) return''; return `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`; }
    const findH = (k) => sectionData[selectedSection].headers.find(h => h.trim().toLowerCase() === String(k).toLowerCase());

    // ====== LOGIN / LOGOUT ======
    async function handleLogin() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        const section = document.getElementById('sectionSelectorLogin').value;
        const errDiv = document.getElementById('login-error');
        errDiv.textContent = '';

        if (!username || !password) { errDiv.textContent = "Entrez nom d'utilisateur et mot de passe."; return; }

        setBtnLoading(document.getElementById('login-button'), true, 'fas fa-sign-in-alt');
        try {
            const response = await fetch('/api/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username, password }) });
            const result = await response.json();
            if (!response.ok || !result.success) throw new Error(result.message || 'Échec connexion.');

            loggedInUser = result.username;
            selectedSection = section;
            isAdmin = admins.has(loggedInUser);
            
            // Vérification de l'autorisation par section pour les non-admins
            if (!isAdmin) {
                if (selectedSection === 'garcons' && !teachers_garcons.has(loggedInUser)) throw new Error('Utilisateur non autorisé pour la section Garçons.');
                if (selectedSection === 'filles' && !teachers_filles.has(loggedInUser)) throw new Error('Utilisateur non autorisée pour la section Filles.');
            }

            // Affichage de l'interface principale
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            
            // Afficher le bon conteneur de section
            document.getElementById('section-content-garcons').style.display = selectedSection === 'garcons' ? 'block' : 'none';
            document.getElementById('section-content-filles').style.display = selectedSection === 'filles' ? 'block' : 'none';

            // Mise à jour de l'UI
            document.getElementById('main-title').textContent = `Plans Hebdomadaires - ${selectedSection.charAt(0).toUpperCase() + selectedSection.slice(1)}`;
            document.getElementById('loggedInUserInfo').textContent = `Connecté: ${loggedInUser}`;

            // Initialiser le sélecteur de semaines
            const weekSelector = document.getElementById('weekSelector');
            weekSelector.innerHTML = '<option value="">-- Sélectionnez une semaine --</option>';
            for (let i = 1; i <= 48; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Semaine ${i}`;
                weekSelector.appendChild(option);
            }
            
            alertMsg(`Bienvenue ${loggedInUser}!`, 'success');

        } catch (e) {
            errDiv.textContent = e.message;
        } finally {
            setBtnLoading(document.getElementById('login-button'), false, 'fas fa-sign-in-alt');
        }
    }

    function handleLogout() {
        loggedInUser = null;
        selectedSection = null;
        isAdmin = false;
        document.getElementById('main-content').style.display = 'none';
        document.getElementById('login-form').style.display = 'block';
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
    }
    
    // ====== DATA & RENDERING ======
    async function loadPlanForWeek() {
        const week = document.getElementById('weekSelector').value;
        currentWeek = week;
        if (!week) { /* ... logique pour réinitialiser ... */ return; }

        try {
            const response = await fetch(`/api/plans/${week}?section=${selectedSection}`);
            const result = await response.json();
            if (!response.ok) throw new Error(result.message || 'Erreur serveur.');

            sectionData[selectedSection].planData = Array.isArray(result.planData) ? result.planData : [];
            sectionData[selectedSection].weeklyClassNotes = result.classNotes || {};
            sectionData[selectedSection].headers = sectionData[selectedSection].planData.length ? Object.keys(sectionData[selectedSection].planData[0]).filter(k => k !== '_id' && k !== 'id') : [];
            
            sortAndDisplay(); // Affiche les données triées par défaut
            populateFilterOptions();
            populateNotesClassSelector();
            updateActionButtonsState(true);

        } catch (e) {
            alertMsg(`Erreur chargement S${week}: ${e.message}`, 'error');
        }
    }

    function sortAndDisplay() {
        const section = selectedSection;
        const data = sectionData[section].planData;

        const ensF = document.getElementById(`filterEnseignant_${section}`).value;
        const clsF = document.getElementById(`filterClasse_${section}`).value;
        const matF = document.getElementById(`filterMatiere_${section}`).value;
        const perF = document.getElementById(`filterPeriode_${section}`).value;
        const jF = document.getElementById(`filterJour_${section}`).value;

        const ensK = findH('Enseignant'), clsK = findH('Classe'), matK = findH('Matière'), perK = findH('Période'), jK = findH('Jour');

        let filtered = data.filter(item => {
            const passEns = !ensF || (ensK && item[ensK] === ensF);
            const passCls = !clsF || (clsK && item[clsK] === clsF);
            const passMat = !matF || (matK && item[matK] === matF);
            const passPer = !perF || (perK && String(item[perK]) === perF);
            const passJour = !jF || (jK && item[jK] === jF);
            return passEns && passCls && passMat && passPer && passJour;
        });

        // Tri par défaut (Classe > Jour > Période)
        const dayOrder = { "Dimanche": 1, "Lundi": 2, "Mardi": 3, "Mercredi": 4, "Jeudi": 5 };
        filtered.sort((a, b) => {
            const classComp = compareClasses(a[clsK], b[clsK]);
            if (classComp !== 0) return classComp;
            const dayComp = (dayOrder[a[jK]] || 99) - (dayOrder[b[jK]] || 99);
            if (dayComp !== 0) return dayComp;
            return (parseInt(a[perK], 10) || 0) - (parseInt(b[perK], 10) || 0);
        });

        sectionData[section].filteredData = filtered;
        renderTable();
    }
    
    function renderTable() {
        const section = selectedSection;
        const thead = document.querySelector(`#planTable_${section} thead tr`);
        const tbody = document.querySelector(`#planTable_${section} tbody`);
        thead.innerHTML = '';
        tbody.innerHTML = '';
        
        const data = sectionData[section].filteredData;
        if (!data || data.length === 0) {
            tbody.innerHTML = `<tr><td colspan="10" style="text-align:center;">Aucune donnée à afficher avec les filtres actuels.</td></tr>`;
            return;
        }

        const headersToDisplay = ['Enseignant', 'Jour', 'Période', 'Classe', 'Matière', 'Leçon', 'Travaux de classe', 'Support', 'Devoirs'];
        headersToDisplay.forEach(h => { const th = document.createElement('th'); th.textContent = h; thead.appendChild(th); });
        const thActions = document.createElement('th'); thActions.textContent = "Actions"; thead.appendChild(thActions);
        const thUpdated = document.createElement('th'); thUpdated.textContent = "Mis à jour"; thead.appendChild(thUpdated);
        
        const editableKeys = new Set(['Leçon', 'Travaux de classe', 'Support', 'Devoirs']);

        data.forEach((rowData, rowIndex) => {
            const tr = document.createElement('tr');
            tr.dataset.rowIndex = rowIndex;
            
            headersToDisplay.forEach(header => {
                const key = findH(header);
                const td = document.createElement('td');
                td.textContent = key ? rowData[key] : '';
                if (editableKeys.has(header)) {
                    td.contentEditable = true;
                    td.classList.add('editable');
                    td.addEventListener('input', (e) => {
                        if (key) rowData[key] = e.target.textContent;
                        tr.classList.add('modified');
                    });
                }
                tr.appendChild(td);
            });
            
            // Colonne Actions
            const tdActions = document.createElement('td');
            const saveBtn = document.createElement('button');
            saveBtn.innerHTML = '<i class="fas fa-check"></i>';
            saveBtn.className = 'save-row-button';
            saveBtn.onclick = () => saveRow(rowData, tr);
            tdActions.appendChild(saveBtn);

            const aiBtn = document.createElement('button');
            aiBtn.innerHTML = '<i class="fas fa-robot"></i>';
            aiBtn.className = 'ai-lesson-plan-button pro-button';
            aiBtn.title = 'Plan de leçon (IA)';
            aiBtn.onclick = () => generateAILessonDocx(rowData, aiBtn);
            tdActions.appendChild(aiBtn);
            tr.appendChild(tdActions);

            // Colonne Mis à jour
            const tdUpdated = document.createElement('td');
            const updKey = findH('updatedAt');
            tdUpdated.textContent = updKey ? formatUpdatedAt(rowData[updKey]) : '';
            tr.appendChild(tdUpdated);

            tbody.appendChild(tr);
        });
    }

    // ====== ACTIONS (SAVE, GENERATE, etc.) ======
    async function saveRow(rowData, tr) {
        const btn = tr.querySelector('.save-row-button');
        setBtnLoading(btn, true, 'fas fa-check');
        try {
            const response = await fetch('/api/save-row', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ week: currentWeek, data: rowData, section: selectedSection })
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.message || 'Erreur de sauvegarde.');
            
            tr.classList.remove('modified');
            // Mettre à jour la date 'updatedAt' dans la vue
            const updKey = findH('updatedAt');
            if (updKey && result.updatedData?.updatedAt) {
                rowData[updKey] = result.updatedData.updatedAt;
                const tdUpdated = tr.cells[tr.cells.length - 1]; // La dernière cellule
                tdUpdated.textContent = formatUpdatedAt(result.updatedData.updatedAt);
            }
            alertMsg('Ligne enregistrée.', 'success');
        } catch (e) {
            alertMsg(e.message, 'error');
        } finally {
            setBtnLoading(btn, false, 'fas fa-check');
        }
    }
    
    // --- Fonctions pour générer Word, Excel, sauvegarder les notes, etc. ---
    // Ces fonctions doivent être adaptées pour utiliser `selectedSection` et les IDs des éléments de la section active.
    // Exemple pour generateWordByClasse :
    async function generateWordByClasse() {
        const section = selectedSection;
        const dataToExport = sectionData[section].filteredData;
        if (!dataToExport.length) { alertMsg('Aucune donnée à exporter.', 'error'); return; }

        setBtnLoading(document.getElementById(`generateWordBtn_${section}`), true, 'fas fa-file-word');
        const byClass = {};
        const classKey = findH('Classe');
        dataToExport.forEach(r => { const c = r[classKey]; if(c) (byClass[c] ||= []).push(r); });
        
        let ok = 0, err = 0;
        for (const classe of Object.keys(byClass)) {
            try {
                const response = await fetch('/api/generate-word', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        week: currentWeek,
                        classe: classe,
                        data: byClass[classe],
                        notes: sectionData[section].weeklyClassNotes[classe] || '',
                        section: section
                    })
                });
                if (!response.ok) throw new Error(`Erreur pour la classe ${classe}`);
                const blob = await response.blob();
                saveAs(blob, `Plan_${section}_S${currentWeek}_${classe}.docx`);
                ok++;
            } catch { err++; }
        }
        alertMsg(err ? `Génération Word: ${ok} succès / ${err} erreurs.` : 'Documents Word générés avec succès.', 'success');
        setBtnLoading(document.getElementById(`generateWordBtn_${section}`), false, 'fas fa-file-word');
    }

    async function generateAILessonDocx(row, btn) { /* ... identique à votre code actuel, mais envoyer `selectedSection` ... */ }
    
    // --- Fonctions pour peupler les filtres, gérer les notes, etc. ---
    function populateFilterOptions() {
        const section = selectedSection;
        const data = sectionData[section].planData;
        const getUniq = (k) => [...new Set(data.map(i => i[k]).filter(Boolean))].sort();

        const updateSel = (id, opts, isClass = false) => {
            const sel = document.getElementById(id);
            sel.innerHTML = `<option value="">${isClass ? 'Toutes' : 'Tous'}</option>`;
            opts.forEach(o => {
                const opt = document.createElement('option');
                opt.value = o;
                opt.textContent = o;
                sel.appendChild(opt);
            });
        };
        
        updateSel(`filterEnseignant_${section}`, getUniq(findH('Enseignant')));
        updateSel(`filterClasse_${section}`, getUniq(findH('Classe')).sort(compareClasses), true);
        updateSel(`filterMatiere_${section}`, getUniq(findH('Matière')));
        updateSel(`filterPeriode_${section}`, getUniq(findH('Période')));
    }

    function populateNotesClassSelector() { /* ... à adapter pour utiliser l'ID de la section ... */ }
    function displayClassNotes() { /* ... à adapter pour utiliser l'ID de la section ... */ }
    async function saveNotes() { /* ... à adapter pour utiliser l'ID de la section ... */ }

    function updateActionButtonsState(enabled) {
        if (!selectedSection) return;
        document.getElementById(`generateWordBtn_${selectedSection}`).disabled = !enabled;
        document.getElementById(`generateExcelBtn_${selectedSection}`).disabled = !enabled;
        document.getElementById(`saveAllDisplayedBtn_${selectedSection}`).disabled = !enabled;
    }

    // ====== EVENTS ======
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('login-button').addEventListener('click', handleLogin);
        document.getElementById('logout-button').addEventListener('click', handleLogout);
        document.getElementById('togglePassword').addEventListener('click', () => {
             const p = document.getElementById('password'); 
             p.type = p.type === 'password' ? 'text' : 'password';
        });

        // Attacher les événements pour chaque section
        ['garcons', 'filles'].forEach(section => {
            document.getElementById(`generateWordBtn_${section}`).addEventListener('click', generateWordByClasse);
            // ... attacher les autres événements pour generateExcel, saveAll, etc. ...
            
            // Événements pour les filtres
            document.getElementById(`filterEnseignant_${section}`).addEventListener('change', sortAndDisplay);
            document.getElementById(`filterClasse_${section}`).addEventListener('change', sortAndDisplay);
            document.getElementById(`filterMatiere_${section}`).addEventListener('change', sortAndDisplay);
            document.getElementById(`filterPeriode_${section}`).addEventListener('change', sortAndDisplay);
            document.getElementById(`filterJour_${section}`).addEventListener('change', sortAndDisplay);
        });
    });

    </script>
</body>
</html>
